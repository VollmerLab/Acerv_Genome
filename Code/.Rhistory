}
read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = make_code(nrow(.))) %>%
group_by(code)
coded_files <- read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = make_code(nrow(.)))
coded_files
length(unique(coded_files$code)) == nrow(coded_files)
coded_files$code[2] <- coded_files$code[1]
length(unique(coded_files$code))
nrow(coded_files)
coded_files$code
duplicated( coded_files$code)
coded_files$code[duplicated(coded_files$code)]
coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
coded_files$code[coded_files$code %in% coded_files$code[duplicated(coded_files$code)]]
coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
multiple_codes <- coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
multiple_codes
coded_files$code[multiple_codes]
make_code(sum(multiple_codes))
make_code <- function(n){
replicate(n, str_c(sample(c(letters, LETTERS, 0:9), 3), collapse = ''))
}
coded_files <- read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = make_code(nrow(.)))
while(length(unique(coded_files$code)) < nrow(coded_files)){
multiple_codes <- coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
coded_files$code[multiple_codes] <- make_code(sum(multiple_codes))
}
coded_files
coded_files
dirname(the_file)
str_c(dirname(the_file), 'config.file', sep = '/')
BiocManager::install("clusterProfiler")
BiocManager::install("clusterProfiler", force = TRUE)
library(clusterProfiler)
data(geneList, package="DOSE")
gene <- names(geneList)[abs(geneList) > 2]
kk <- enrichKEGG(gene         = gene,
organism     = 'hsa',
pvalueCutoff = 0.05)
head(kk)
?enrichKEGG
data(geneList, package='DOSE')
de <- names(geneList)[1:100]
yy <- enrichKEGG(de, pvalueCutoff=0.01)
head(yy)
ggo <- groupGO(gene     = gene,
OrgDb    = org.Hs.eg.db,
ont      = "CC",
level    = 3,
readable = TRUE)
?groupGO
data(gcSample)
yy <- groupGO(gcSample[[1]], 'org.Hs.eg.db', ont="BP", level=2)
?gseKEGG
data(geneList, package="DOSE")
kk2 <- gseKEGG(geneList     = geneList,
organism     = 'hsa',
minGSSize    = 120,
pvalueCutoff = 0.05,
verbose      = FALSE)
geneList
kk2 <- gseKEGG(geneList     = geneList,
organism     = 'hsa',
minGSSize    = 120,
pvalueCutoff = 0.05,
verbose      = FALSE)
kk2 <- gseKEGG(geneList     = geneList,
organism     = 'hsa',
minGSSize    = 120,
pvalueCutoff = 0.05,
verbose      = TRUE)
geneList
?geneList
library(fgsea)
data(examplePathways)
data(exampleRanks)
exampleRanks
examplePathways
?examplePathways
fgseaRes <- fgsea(pathways = examplePathways,
stats    = exampleRanks,
minSize  = 15,
maxSize  = 500)
fgseaRes
length(exampleRanks)
dim(exampleRanks)
names(exampleRanks)[1:5]
exampleRanks[1:5]
examplePathways[[1]]
remotes::install_github("gavinsimpson/gratia")
setwd("C:/Users/jdsel/Documents/Google Drive/Research/Vollmer Lab PostDoc/Comparative_Genomics/Code")
#### Libraries ####
library(tidyverse)
#### Data ####
cafe5_results <- full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_count.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'n_gene'),
read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_change.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'gene_change'),
by = c('FamilyID', 'tree_node')) %>%
full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_branch_probabilities.tab', delim = '\t',
show_col_types = FALSE) %>%
select(-...49, -`<46>`) %>%
rename(FamilyID = `#FamilyID`) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'node_probability'),
by = c('FamilyID', 'tree_node')) %>%
left_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_family_results.txt', delim = '\t',
show_col_types = FALSE) %>%
rename(FamilyID = `#FamilyID`,
family_probability = pvalue) %>%
select(-`Significant at 0.05`),
by = 'FamilyID') %>%
rename(Orthogroup = FamilyID,
cafe_gene = n_gene) %>%
mutate(species = str_extract(tree_node, '[a-z_]+')) %>%
filter(!is.na(species)) %>%
select(-tree_node) %>%
select(Orthogroup, species, cafe_gene, gene_change, family_probability, node_probability)
read_csv('../intermediate_files/kegg_gene_pathways.csv.gz', show_col_types = FALSE)
orthogroup_kegg <- read_csv('../intermediate_files/kegg_gene_pathways.csv.gz', show_col_types = FALSE)
problems(orthogroup_kegg)
orthogroup_kegg <- read_csv('../intermediate_files/kegg_gene_pathways.csv.gz', show_col_types = TRUE)
orthogroup_kegg <- read_csv('../intermediate_files/kegg_gene_pathways.csv.gz', show_col_types = TRUE, guess_max = 1e5)
orthogroup_kegg <- read_csv('../intermediate_files/kegg_gene_pathways.csv.gz', show_col_types = FALSE, guess_max = 1e5)
orthogroup_kegg
full_join(cafe5_results,
species_kegg,
by = c('Orthogroup'))
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup'))
#### Data ####
cafe5_results <- full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_count.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'n_gene'),
read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_change.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'gene_change'),
by = c('FamilyID', 'tree_node')) %>%
full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_branch_probabilities.tab', delim = '\t',
show_col_types = FALSE) %>%
select(-...49, -`<46>`) %>%
rename(FamilyID = `#FamilyID`) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'node_probability'),
by = c('FamilyID', 'tree_node')) %>%
left_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_family_results.txt', delim = '\t',
show_col_types = FALSE) %>%
rename(FamilyID = `#FamilyID`,
family_probability = pvalue) %>%
select(-`Significant at 0.05`),
by = 'FamilyID') %>%
rename(Orthogroup = FamilyID) %>%
mutate(species = str_extract(tree_node, '[a-z_]+')) %>%
filter(!is.na(species)) %>%
select(-tree_node) %>%
select(Orthogroup, species, cafe_gene, gene_change, family_probability, node_probability)
#### Data ####
cafe5_results <- full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_count.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'n_gene'),
read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_change.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'gene_change'),
by = c('FamilyID', 'tree_node')) %>%
full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_branch_probabilities.tab', delim = '\t',
show_col_types = FALSE) %>%
select(-...49, -`<46>`) %>%
rename(FamilyID = `#FamilyID`) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'node_probability'),
by = c('FamilyID', 'tree_node')) %>%
left_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_family_results.txt', delim = '\t',
show_col_types = FALSE) %>%
rename(FamilyID = `#FamilyID`,
family_probability = pvalue) %>%
select(-`Significant at 0.05`),
by = 'FamilyID') %>%
rename(Orthogroup = FamilyID) %>%
mutate(species = str_extract(tree_node, '[a-z_]+')) %>%
filter(!is.na(species)) %>%
select(-tree_node) %>%
select(Orthogroup, species, n_gene, gene_change, family_probability, node_probability)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
select(Orthogroup, species, kegg_gene)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup'))
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene))
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer')
orthogroup_kegg
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer')
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer') %>%
filter(family_probability < 0.05)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer') %>%
filter(family_probability < 0.05,
node_probability < 0.05)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer') %>%
filter(family_probability < 0.05,
node_probability < 0.05,
!is.na(kegg_gene))
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer') %>%
filter(family_probability < 0.05,
node_probability < 0.05,
!is.na(kegg_gene)) %>% View
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene))
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene)) %>%
write_csv('../intermediate_files/acer_orthogroupChange.csv')
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene)) %>%
write_csv('../Results/acer_orthogroupChange.csv')
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup'))
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
write_csv('../Results/acer_orthogroupChange.csv')
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols')
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols') %>%
filter(gene_change < 0)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols') %>%
write_csv('../Results/acer_orthogroupChange.csv')
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols')
#### Libraries ####
library(tidyverse)
#### Data ####
cafe5_results <- full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_count.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'n_gene'),
read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_change.tab', delim = '\t',
show_col_types = FALSE) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'gene_change'),
by = c('FamilyID', 'tree_node')) %>%
full_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_branch_probabilities.tab', delim = '\t',
show_col_types = FALSE) %>%
select(-...49, -`<46>`) %>%
rename(FamilyID = `#FamilyID`) %>%
pivot_longer(cols = -FamilyID,
names_to = 'tree_node',
values_to = 'node_probability'),
by = c('FamilyID', 'tree_node')) %>%
left_join(read_delim('../../Bioinformatics/Phylogenomics/Time Calibration/cafeOut/errorModel/Base_family_results.txt', delim = '\t',
show_col_types = FALSE) %>%
rename(FamilyID = `#FamilyID`,
family_probability = pvalue) %>%
select(-`Significant at 0.05`),
by = 'FamilyID') %>%
rename(Orthogroup = FamilyID) %>%
mutate(species = str_extract(tree_node, '[a-z_]+')) %>%
filter(!is.na(species)) %>%
select(-tree_node) %>%
select(Orthogroup, species, n_gene, gene_change, family_probability, node_probability)
orthogroup_kegg <- read_csv('../intermediate_files/kegg_gene_pathways.csv.gz',
show_col_types = FALSE, guess_max = 1e5)
#### What expanded/contracted in Acer ####
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols') %>%
write_csv('../Results/acer_orthogroupChange.csv')
full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols')
library(magrittr)
#### What expanded/contracted in Acer ####
acer_changes <- full_join(cafe5_results,
orthogroup_kegg,
by = c('Orthogroup')) %>%
filter(species == 'acer',
!is.na(kegg_gene),
family_probability < 0.05,
node_probability < 0.05) %>%
janitor::remove_empty(which = 'cols') %T>%
write_csv('../Results/acer_orthogroupChange.csv')
acer_changes
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits))
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE)
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>% View
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE)
acer_changes
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE)
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
group_by(major, minor, pathway) %>%
summarise(expansion = sum(gene_change > 0),
contraction = sum(gene_change < 0))
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
group_by(major, minor, pathway) %>%
summarise(expansion = sum(gene_change > 0),
contraction = sum(gene_change < 0),
.groups = 'drop')
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE)
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
rowwise %>%
mutate(pathway = str_split(pathway, '; '))
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
rowwise %>%
mutate(pathway = str_split(pathway, '; ')) %>%
unnest(pathway)
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
rowwise %>%
mutate(pathway = str_split(pathway, '; ')) %>%
unnest(pathway) %>%
group_by(major, minor, pathway) %>%
summarise(expansion = sum(gene_change > 0),
contraction = sum(gene_change < 0),
.groups = 'drop')
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
rowwise %>%
mutate(pathway = str_split(pathway, '; ')) %>%
unnest(pathway) %>%
group_by(major, minor, pathway) %>%
summarise(expansion = sum(gene_change > 0),
contraction = sum(gene_change < 0),
.groups = 'drop') %>%
filter(str_detect(minor, 'Immune'))
acer_changes %>%
pivot_longer(cols = -c(Orthogroup:prop_top_hits),
names_to = c('major', 'minor'),
names_pattern = '(.*) - (.*)',
values_to = 'pathway',
values_drop_na = TRUE) %>%
rowwise %>%
mutate(pathway = str_split(pathway, '; ')) %>%
unnest(pathway) %>%
group_by(major, minor, pathway) %>%
summarise(expansion = sum(gene_change > 0),
contraction = sum(gene_change < 0),
.groups = 'drop') %>%
filter(str_detect(minor, 'Immune')) %>% View
