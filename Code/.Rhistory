theme(panel.background = element_rect(colour = 'black'),
strip.background = element_blank(),
axis.text = element_text(colour = 'black', size = 12),
axis.title = element_text(colour = 'black', size = 16),
legend.text = element_text(colour = 'black', size = 14),
legend.position = 'bottom')
pathway_changes
filter(pathway_changes, FamilyID %in% paths_particular_interest)
read_lines('../../Bioinformatics/Phylogenomics/Time Calibration/cafe_keggPaths/cafeOut/errorModel/Base_asr.tre') %>%
str_subset('^ *TREE') %>%
tibble(tree = .) %>%
mutate(FamilyID = str_extract(tree, 'map[0-9]+'),
tree = str_remove(tree, str_c(' *TREE ', FamilyID, ' = ')))
#### Read in Cafe Results - KEGG Paths ####
cafe_trees_base <- read_lines('../../Bioinformatics/Phylogenomics/Time Calibration/cafe_keggPaths/cafeOut/errorModel/Base_asr.tre') %>%
str_subset('^ *TREE') %>%
tibble(tree = .) %>%
mutate(FamilyID = str_extract(tree, 'map[0-9]+'),
tree = str_remove(tree, str_c(' *TREE ', FamilyID, ' = ')))
cafe_trees_base %>%
filter(FamilyID %in% paths_particular_interest)
cafe_trees_base %>%
filter(FamilyID %in% paths_particular_interest) %>%
rowwise %>%
mutate(tree = list(read.tree(text = tree)))
kegg_paths
cafe_trees_base %>%
filter(FamilyID %in% paths_particular_interest) %>%
left_join(kegg_paths,
by = c('FamilyID' = 'kegg_path_id'))
tmp <- cafe_trees_base %>%
filter(FamilyID %in% paths_particular_interest) %>%
left_join(kegg_paths,
by = c('FamilyID' = 'kegg_path_id')) %>%
rowwise %>%
mutate(tree = list(read.tree(text = tree))) %>%
ungroup
pathway_changes
tmp <- cafe_trees_base %>%
filter(FamilyID %in% paths_particular_interest) %>%
left_join(pathway_changes,
by = c('FamilyID')) %>%
rowwise %>%
mutate(tree = list(read.tree(text = tree))) %>%
ungroup
tmp
tmp <- cafe_trees_base %>%
left_join(pathway_changes,
by = c('FamilyID')) %>%
rowwise %>%
mutate(tree = list(read.tree(text = tree))) %>%
ungroup
tmp
tmp <- cafe_trees_base %>%
filter(FamilyID %in% paths_particular_interest) %>%
left_join(pathway_changes,
by = c('FamilyID')) %>%
rowwise %>%
mutate(tree = list(read.tree(text = tree))) %>%
ungroup
tmp
tmp$tree[[2]]
tmp$tree[[2]] %>%
ggtree
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab()
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab()
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
theme(plot.margin = margin(10, 150, 10, 10),
panel.background = element_blank(),
plot.background = element_rect(colour = 'black', linewidth = 1),
legend.position = c(0.2, 0.8),
legend.direction = "horizontal",
axis.text.x = element_text(colour = 'black', size = 14),
axis.title.x = element_text(colour = 'black', size = 18))
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
theme(plot.margin = margin(150, 150, 10, 10),
panel.background = element_blank(),
plot.background = element_rect(colour = 'black', linewidth = 1),
legend.position = c(0.2, 0.8),
legend.direction = "horizontal",
axis.text.x = element_text(colour = 'black', size = 14),
axis.title.x = element_text(colour = 'black', size = 18))
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
theme(plot.margin = margin(10, 15, 10, 10),
panel.background = element_blank(),
plot.background = element_rect(colour = 'black', linewidth = 1),
legend.position = c(0.2, 0.8),
legend.direction = "horizontal",
axis.text.x = element_text(colour = 'black', size = 14),
axis.title.x = element_text(colour = 'black', size = 18))
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(0, 100))
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-100, 0))
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab()
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-425, 10), labels = abs)
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425), labels = abs)
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425))
tmp$tree[[1]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425))
tmp$tree[[1]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425)) +
labs(title = tmp$name[[1]])
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425)) +
labs(title = tmp$name[[2]])
tmp$tree[[3]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425)) +
labs(title = tmp$name[[3]])
tmp$tree[[4]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425)) +
labs(title = tmp$name[[4]])
tmp
the_tree
as_tibble(tmp$tree[[4]])
as_tibble(tmp$tree[[4]]) %>%
mutate(cafe_nodeID = str_extract(label, '(([a-z_])+)?\\<[0-9]+\\>'),
label = str_replace(label, '\\<[0-9]+\\>', str_c('<', node, '>')))
as_tibble(tmp$tree[[4]]) %>%
mutate(cafe_nodeID = str_extract(label, '(([a-z_])+)?\\<[0-9]+\\>'),
label = str_replace(label, '\\<[0-9]+\\>', str_c('<', node, '>'))) %>%
left_join(the_tree)
as_tibble(tmp$tree[[4]]) %>%
mutate(cafe_nodeID = str_extract(label, '(([a-z_])+)?\\<[0-9]+\\>'),
label = str_replace(label, '\\<[0-9]+\\>', str_c('<', node, '>')),
n_keggs = str_extract(label, '[0-9]+$'))
as_tibble(tmp$tree[[4]]) %>%
mutate(cafe_nodeID = str_extract(label, '(([a-z_])+)?\\<[0-9]+\\>'),
label = str_replace(label, '\\<[0-9]+\\>', str_c('<', node, '>')),
n_keggs = str_extract(label, '[0-9]+$') %>% as.integer)
cafe_trees <- cafe_trees_base %>%
# slice(1:10) %>%
rowwise(FamilyID) %>%
partition(cluster) %>%
summarise(read.tree(text = tree) %>%
as_tibble() %>%
mutate(cafe_nodeID = str_extract(label, '(([a-z_])+)?\\<[0-9]+\\>'),
label = str_replace(label, '\\<[0-9]+\\>', str_c('<', node, '>')),
n_keggs = str_extract(label, '[0-9]+$') %>% as.integer) %>%
select(label, cafe_nodeID, n_keggs)) %>%
collect %>%
ungroup %>%
mutate(is_significant = str_detect(label, '\\*'),
ortho_nodeID = str_extract(label, '\\<[0-9]+\\>') %>% str_remove_all(c('\\<|\\>')) %>% as.integer,
n_gene = str_extract(label, '[0-9]+$') %>% as.integer())
cafe_trees
#### Read in Cafe Results - KEGG Paths ####
cafe_trees <- read_lines('../../Bioinformatics/Phylogenomics/Time Calibration/cafe_keggPaths/cafeOut/errorModel/Base_asr.tre') %>%
str_subset('^ *TREE') %>%
tibble(tree = .) %>%
mutate(FamilyID = str_extract(tree, 'map[0-9]+'),
tree = str_remove(tree, str_c(' *TREE ', FamilyID, ' = '))) %>%
# slice(1:10) %>%
rowwise(FamilyID) %>%
partition(cluster) %>%
summarise(read.tree(text = tree) %>%
as_tibble() %>%
mutate(cafe_nodeID = str_extract(label, '(([a-z_])+)?\\<[0-9]+\\>'),
label = str_replace(label, '\\<[0-9]+\\>', str_c('<', node, '>')),
n_keggs = str_extract(label, '[0-9]+$') %>% as.integer) %>%
select(label, cafe_nodeID, n_keggs)) %>%
collect %>%
ungroup %>%
mutate(is_significant = str_detect(label, '\\*'),
ortho_nodeID = str_extract(label, '\\<[0-9]+\\>') %>% str_remove_all(c('\\<|\\>')) %>% as.integer,
n_gene = str_extract(label, '[0-9]+$') %>% as.integer())
cafe_trees
cafe_trees %>%
filter(FamilyID == 'map00010')
the_tree
the_tree %>%
left_join(cafe_trees %>%
filter(FamilyID == 'map00010'),
by = c('node' = 'ortho_nodeID'))
cafe_trees
cafe_trees %>%
nest_by(Family_ID)
cafe_trees %>%
nest_by(FamilyID)
cafe_trees %>%
nest_by(FamilyID) %>%
mutate(tree = list(left_join(the_tree,
data,
by = c('node' = 'ortho_nodeID'))))
pathway_changes
cafe_trees %>%
nest(data = -c(FamilyID)) %>%
left_join(pathway_changes,
by = 'FamilyID')
cafe_trees %>%
nest(data = -c(FamilyID)) %>%
left_join(pathway_changes,
by = 'FamilyID') %>%
rowwise %>%
mutate(tree = list(left_join(the_tree,
data,
by = c('node' = 'ortho_nodeID')))) %>%
ungroup
cafe_trees %>%
nest(data = -c(FamilyID)) %>%
left_join(pathway_changes,
by = 'FamilyID') %>%
rowwise %>%
mutate(tree = list(left_join(the_tree,
data,
by = c('node' = 'ortho_nodeID')))) %>%
ungroup %>%
filter(pvalue < 0.05)
#### Trees for Individual Pathways ####
individual_pathway_trees <- cafe_trees %>%
nest(data = -c(FamilyID)) %>%
left_join(pathway_changes,
by = 'FamilyID') %>%
rowwise %>%
mutate(tree = list(left_join(the_tree,
data,
by = c('node' = 'ortho_nodeID')))) %>%
ungroup
individual_pathway_trees$tree[[1]]
#### Trees for Individual Pathways ####
tree <- individual_pathway_trees$tree[[1]]
tree %>%
ggtree(layout = 'rectangular')
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic")
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)))
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 0)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 0.5)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1, vjust = 1)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1, vjust = 0)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = 0)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5)
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
coord_geo(xlim = c(-425, 0), ylim = c(0, Ntip(the_tree)),
neg = TRUE, abbrv = TRUE,
dat = 'periods', clip = "off")
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(10, 425))
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425))
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2() +
theme(plot.margin = margin(10, 150, 10, 10),
panel.background = element_blank(),
plot.background = element_rect(colour = 'black', linewidth = 1),
legend.position = c(0.3, 0.8),
legend.direction = "horizontal",
legend.text = element_text(colour = 'black', size = 12),
legend.title = element_text(colour = 'black', size = 16),
axis.text.x = element_text(colour = 'black', size = 12),
axis.title.x = element_text(colour = 'black', size = 16))
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2()
make_tree_plot <- function(tree){
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2()
}
cafe_trees
individual_pathway_trees
tmp
tmp$tree[[2]] %>%
ggtree() +
geom_nodelab() +
geom_tiplab() +
scale_x_continuous(limits = c(-10, 425)) +
labs(title = tmp$name[[4]])
cafe_trees
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species, colour = is_significant), hjust = 0,
fontface = "italic") +
geom_nodelab(aes(label = scales::comma(n_gene), colour = is_significant),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2()
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_tippoint() +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2()
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_tippoint(aes(colour = is_significant)) +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2()
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_tippoint(aes(colour = is_significant)) +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
geom_nodepoint(aes(colour = is_significant)) +
scale_x_continuous(limits = c(-10, 425)) +
theme_tree2()
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_tippoint(aes(colour = is_significant)) +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
geom_nodepoint(aes(colour = is_significant)) +
scale_x_continuous(limits = c(-10, 425)) +
guides(colour = 'none') +
theme_tree2()
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_tippoint(aes(colour = is_significant)) +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
geom_nodepoint(aes(colour = is_significant)) +
scale_x_continuous(limits = c(-10, 425)) +
scale_colour_manual(values = c('TRUE' = 'red', 'FALSE' = 'black')) +
guides(colour = 'none') +
theme_tree2()
make_tree_plot <- function(tree){
tree %>%
mutate(species = str_c(species, ' (', n_gene, ')')) %>%
ggtree(layout = 'rectangular') +
geom_tiplab(aes(label = species), hjust = 0,
fontface = "italic") +
geom_tippoint(aes(colour = is_significant)) +
geom_nodelab(aes(label = scales::comma(n_gene)),
hjust = 1.5, vjust = -0.5) +
geom_nodepoint(aes(colour = is_significant)) +
scale_x_continuous(limits = c(-10, 425)) +
scale_colour_manual(values = c('TRUE' = 'red', 'FALSE' = 'black')) +
guides(colour = 'none') +
theme_tree2()
}
individual_pathway_trees
individual_pathway_trees <- cafe_trees %>%
nest(data = -c(FamilyID)) %>%
left_join(pathway_changes,
by = 'FamilyID') %>%
rowwise %>%
mutate(tree = list(left_join(the_tree,
data,
by = c('node' = 'ortho_nodeID')))) %>%
ungroup %>%
rowwise %>%
mutate(tree_plot = list(make_tree_plot(tree) + labs(title = name, subtitle = scales::pvalue(pvalue))))
individual_pathway_trees <- cafe_trees %>%
nest(data = -c(FamilyID)) %>%
left_join(pathway_changes,
by = 'FamilyID') %>%
rowwise %>%
mutate(tree = list(left_join(the_tree,
data,
by = c('node' = 'ortho_nodeID')))) %>%
ungroup %>%
filter(FamilyID %in% paths_particular_interest) %>%
rowwise %>%
mutate(tree_plot = list(make_tree_plot(tree) + labs(title = name, subtitle = scales::pvalue(pvalue)))) %>%
ungroup
