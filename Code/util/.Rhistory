the_file <- args[1]
} else {
the_file <- 'C:/Users/jdsel/Documents/Google Drive/Research/Vollmer Lab PostDoc/Bioinformatics/tmp/rna_sequence_files.txt'
}
the_file
readr::read_lines(the_file)
suppressMessages(suppressWarnings(library(tidyverse)))
read_lines(the_file)
read_lines(the_file) %>%
tibble(file = .)
c(letters, LETTERS)
sample(c(letters, LETTERS, 0:9), 3)
str_c(sample(c(letters, LETTERS, 0:9), 3), collapse = '')
replicate(5, str_c(sample(c(letters, LETTERS, 0:9), 3), collapse = ''))
read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = replicate(nrow(.), str_c(sample(c(letters, LETTERS, 0:9), 3), collapse = '')))
make_code <- function(n){
replicate(n, str_c(sample(c(letters, LETTERS, 0:9), 3), collapse = ''))
}
read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = make_code(nrow(.))) %>%
group_by(code)
coded_files <- read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = make_code(nrow(.)))
coded_files
length(unique(coded_files$code)) == nrow(coded_files)
coded_files$code[2] <- coded_files$code[1]
length(unique(coded_files$code))
nrow(coded_files)
coded_files$code
duplicated( coded_files$code)
coded_files$code[duplicated(coded_files$code)]
coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
coded_files$code[coded_files$code %in% coded_files$code[duplicated(coded_files$code)]]
coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
multiple_codes <- coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
multiple_codes
coded_files$code[multiple_codes]
make_code(sum(multiple_codes))
make_code <- function(n){
replicate(n, str_c(sample(c(letters, LETTERS, 0:9), 3), collapse = ''))
}
coded_files <- read_lines(the_file) %>%
tibble(file = .) %>%
mutate(code = make_code(nrow(.)))
while(length(unique(coded_files$code)) < nrow(coded_files)){
multiple_codes <- coded_files$code %in% coded_files$code[duplicated(coded_files$code)]
coded_files$code[multiple_codes] <- make_code(sum(multiple_codes))
}
coded_files
coded_files
dirname(the_file)
str_c(dirname(the_file), 'config.file', sep = '/')
library(tidyverse)
library(rentrez)
shinzato_bioproj <- 'PRJDB8519'
?entrez_search
entrez_db_searchable()
entrez_dbs()
entrez_search(db = 'bioproject', term = shinzato_bioproj)
tst <- entrez_search(db = 'bioproject', term = shinzato_bioproj)
tst$ids
entrez_dbs()
entrez_db_links('bioproject')
entrez_link(dbfrom = 'bioproject', id = tst$ids, db = 'sra')
blah <- entrez_link(dbfrom = 'bioproject', id = tst$ids, db = 'sra')
blah$links
blah$links$bioproject_sra
blah$links$bioproject_sra[1]
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra[1])
?entrez_fetch
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra[1], rettype = 'fasta')
blat
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra[1], rettype = 'XML')
blat
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra[1], rettype = 'text')
blat
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra[1], rettype = 'JSON')
blat
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra[1], rettype = 'XML', parsed = TRUE)
blat <- entrez_fetch(db = 'sra', id = blah$links$bioproject_sra, rettype = 'XML')
blat
blat[[1]]
length(blat)
length(blat[[1]])
length(blat[[1]][[1]])
library(xml2)
read_xml(blat)
read_xml(blat) %>%
xml_find_all('accession')
read_xml(blat) %>%
xml_find_all('accession')
read_xml(blat) %>%
as_tibble
read_xml(blat)
blam <- read_xml(blat)
blam$node
blam %>% str
XML::xmlToDataFrame(blam)
XML::xmlToDataFrame(blat)
XML::xmlToDataFrame(blat) %>%
as_tibble()
XML::xmlToDataFrame(blat) %>%
as_tibble()
blam
blam %>%
as.character()
blam
blam$doc
blam %>%
xml_find_all('EXPERIMENT_PACKAGE')
blam %>%
as_list()
blam <- read_xml(blat) %>%
as_list()
blam[[1]]
blam[[1]]$EXPERIMENT_PACKAGE
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('accession')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('PRIMARY_ID')
read_xml(blat) %>%
xml_find_all('PRIMARY_ID')
read_xml(blat)
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('IDENTIFIERS')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_text
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()
read_xml(blat) %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
# xml_children()
xml_find_all('Pool')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()EXPERIMENT
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
# xml_children()EXPERIMENT
xml_find_all('EXPERIMENT ')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
# xml_children()
xml_find_all('EXPERIMENT')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
# xml_children()
xml_find_all('EXPERIMENT') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('PRIMARY_ID')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('TAXON_ID')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('TAXON_ID') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('SCIENTIFIC_NAME') %>%
xml_text()
process_sra_out <- function(sra_out){
tibble(sra_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_text(),
species = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('SCIENTIFIC_NAME') %>%
xml_text(),
taxon_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('TAXON_ID') %>%
xml_text())
}
process_sra_out(blat)
get_bioproj_sra <- function(proj_id){
bio_ids <- entrez_search(db = 'bioproject', term = proj_id)
link_ids <- entrez_link(dbfrom = 'bioproject', id = bio_ids$ids, db = 'sra')
entrez_fetch(db = 'sra', id = link_ids$links$bioproject_sra, rettype = 'XML') %>%
process_sra_out()
}
get_bioproj_sra(shinzato_bioproj)
?tribble
#### Data ####
tribble(
~author, ~bioproject,
'shinzato', 'PRJDB8519'
)
#### Data ####
bioproj_data <- tribble(
~author, ~bioproject,
'shinzato', 'PRJDB8519'
)
#### Download SRA metadata ####
blam <- bioproj_data %>%
rowwise %>%
reframe(get_bioproj_sra(bioproject))
blam
blat
read_xml(blat)
read_xml(blat) %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('IDENTIFIERS')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('EXTERNAL_ID')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('EXTERNAL_ID') %>%
xml_text()
process_sra_out <- function(sra_out){
tibble(sra_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_text(),
species = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('SCIENTIFIC_NAME') %>%
xml_text(),
taxon_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('TAXON_ID') %>%
xml_text(),
sample_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('EXTERNAL_ID') %>%
xml_text())
}
#### Data ####
bioproj_data <- tribble(
~author, ~bioproject,
'shinzato', 'PRJDB8519'
)
gene_locations
#### Download SRA metadata ####
blam <- bioproj_data %>%
rowwise %>%
reframe(get_bioproj_sra(bioproject))
blam
#### Download SRA metadata ####
blam <- bioproj_data %>%
rowwise %>%
reframe(get_bioproj_sra(bioproject)) %>%
filter(str_detect(species, 'Acropora'))
blam
blam %>%
count(species, sample_id)
blam %>%
count(species, sample_id) %>%
count(species)
#### Download SRA metadata ####
blam <- bioproj_data %>%
rowwise %>%
reframe(get_bioproj_sra(bioproject)) %>%
filter(str_detect(species, 'Acropora'))
blam
#### Download SRA metadata ####
sequence_ids <- bioproj_data %>%
rowwise %>%
reframe(get_bioproj_sra(bioproject)) %>%
filter(str_detect(species, 'Acropora'))
setwd("C:/Users/jdsel/Documents/Google Drive/Research/Vollmer Lab PostDoc/Comparative_Genomics/Code/util")
write_csv('../../intermediate_files/sra_ids.csv')
write_csv(sequence_ids, '../../intermediate_files/sra_ids.csv')
read_xml(blat)
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('RUN alias') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('RUN alias')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
# xml_find_all('RUN alias') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('RUN') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('RUN')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('alias') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_children()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('IDENTIFIERS') %>%
xml_text()
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('IDENTIFIERS')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID')
read_xml(blat) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_text()
process_sra_out <- function(sra_out){
tibble(sequence_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('EXPERIMENT') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_text(),
species = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('SCIENTIFIC_NAME') %>%
xml_text(),
taxon_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('SAMPLE_NAME') %>%
xml_find_all('TAXON_ID') %>%
xml_text(),
sample_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('SAMPLE') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('EXTERNAL_ID') %>%
xml_text(),
sra_id = read_xml(sra_out) %>%
xml_find_all('EXPERIMENT_PACKAGE') %>%
xml_find_all('RUN_SET') %>%
xml_find_all('RUN') %>%
xml_find_all('IDENTIFIERS') %>%
xml_find_all('PRIMARY_ID') %>%
xml_text())
}
#### Data ####
bioproj_data <- tribble(
~author, ~bioproject,
'shinzato', 'PRJDB8519'
)
#### Download SRA metadata ####
sequence_ids <- bioproj_data %>%
rowwise %>%
reframe(get_bioproj_sra(bioproject)) %>%
filter(str_detect(species, 'Acropora'))
sequence_ids
write_csv(sequence_ids, '../../intermediate_files/sra_ids.csv')
sequence_ids
emmeans:::poly.emmc(1:3)
